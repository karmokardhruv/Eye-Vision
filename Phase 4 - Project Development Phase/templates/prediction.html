<!DOCTYPE html>
<html lang="en">
<head>  
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>EyeVision</title>
    <link rel="icon" href="static/images/icon.ico" type="image/x-icon" />
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous"/>
    
    <!-- Custom CSS -->
    <link href="{{ url_for('static', filename='css/main.css') }}" rel="stylesheet"/>
    <link rel="stylesheet" href="../static/css/style.css" />
</head>
<body style="background-image: url('../static/images/background.jpg'); background-size: cover; background-attachment: fixed;">
    
    <!-- Header Section -->
    <section class="header fixed-content header-colour">
        <header class="p-3">
            <div class="container header-container">
                <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
                    <a href="/" class="d-flex align-items-center mb-2 mb-lg-0 text-white text-decoration-none" previewlistener="true">
                        <svg class="bi me-2" width="40" height="32" role="img" aria-label="Bootstrap">
                            <use xlink:href="#bootstrap"></use>
                        </svg>
                    </a>
                    <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 mb-md-0">
                        <li><a href="{{ url_for('home') }}" id="home" class="nav-link px-3 text-black">Home</a></li>
                        <li><a href="{{ url_for('feedback') }}" id="feedback" class="nav-link px-3 text-black">Feedback</a></li>
                        <li><a href="{{ url_for('about') }}" id="about" class="nav-link px-3 text-black">About</a></li>
                        <li><a href="{{ url_for('contact') }}" id="contact" class="nav-link px-3 text-black">Contact Us</a></li>
                    </ul>
                </div>
            </div>
        </header>
    </section>

    <!-- Prediction Section -->
    <section class="top-margin">
        <div class="container my-5">
            <section class="flex-vala-box about-content">
                <div>
                    <div class="image-pred">
                        <h2>Vision AI</h2>
                        <form id="upload-file" method="post" enctype="multipart/form-data">
                            <!-- Unique ID for Upload Button -->
                            <label id="upload-button" class="btn lead btn-primary btn-lg px-4 me-md-2 upload-label" for="imageUpload">Upload Image</label>
                            <input type="file" name="file" id="imageUpload" accept=".png, .jpg, .jpeg"/>
                        </form>

                        <!-- Image Preview and Predict Button -->
                        <div class="image-section" style="display: none">
                            <div class="img-preview">
                                <div id="imagePreview"></div>
                            </div>
                            <div>
                                <!-- Unique ID and Class for Predict Button -->
                                <button type="button" class="btn btn-primary btn-lg px-4 me-md-2 predict-button" id="btn-predict">Predict</button>
                            </div>
                        </div>
                    </div>

                    <!-- Loader Animation -->
                    <div class="loader" style="display: none"></div>

                    <!-- Result Display -->
                    <h3 id="result" class="apna">
                        <span> </span>
                    </h3>
                </div>

                <!-- Disease Information Display -->
                <div id="description">
                    <h4 id="disease-name"></h4>
                    <h5>Embark on a seamless journey towards comprehensive eye health understanding!</h5>
                    <p>Embark on a seamlessly informative journey toward a profound understanding of comprehensive eye health! By effortlessly uploading an image, you empower our cutting-edge model, which leverages the strength of robust deep-learning techniques such as Inception V3, VGG19, and Xception V3. This state-of-the-art technology enables the accurate prediction and categorization of various eye conditions, including Cataract, Diabetic Retinopathy, and Glaucoma. Experience the unparalleled precision of our predictive analytics, as you receive tailored insights and detailed descriptions for each identified condition. This user-friendly process is meticulously designed not only to furnish you with precise predictions but also to elevate your awareness of eye health. Your active participation becomes the cornerstone of this enlightening journey, contributing to a more informed and proactive approach to caring for your eyes.</p>
                </div>
            </section>
        </div>
    </section>

    <!-- jQuery 3.7.1 -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    
    <!-- Bootstrap 5.3.2 Bundle JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    
    <!-- Custom JS (Ensure these files do not conflict with the prediction functionality) -->
    <script src="{{ url_for('static', filename='js/main.js') }}" type="text/javascript"></script>
    <script src="../static/index.js" charset="utf-8"></script>
    
    <!-- Corrected JavaScript -->
    <script>
        $(document).ready(function () {
            // Initially hide elements
            $('.image-section').hide();
            $('.loader').hide();
            $('#result').hide();

            // Function to display image preview
            function readURL(input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        $('#imagePreview').css('background-image', 'url(' + e.target.result + ')');
                        $('#imagePreview').hide();
                        $('#imagePreview').fadeIn(650);
                    }
                    reader.readAsDataURL(input.files[0]);
                }
            }

            // When an image is uploaded
            $("#imageUpload").change(function () {
                $('.image-section').show();  // Show the image preview section
                $('#btn-predict').show();    // Show the predict button
                $('#result').text('');       // Clear any previous results
                $('#result').hide();         // Hide the result section initially
                readURL(this);               // Display image preview
            });

            // When the "Predict" button is clicked
            $('#btn-predict').click(function () {
                var form_data = new FormData($('#upload-file')[0]);  // Collect the form data

                // Hide the button and show the loader
                $(this).hide();
                $('.loader').show();

                // AJAX call to the backend for prediction
                $.ajax({
                    type: 'POST',
                    url: '/predict',  // Ensure this URL is correct for your backend
                    data: form_data,
                    contentType: false,
                    cache: false,
                    processData: false,
                    async: true,
                    success: function (data) {
                        // Hide the loader
                        $('.loader').hide();
                        $('#result').fadeIn(600);  // Fade in the result section

                        // Update description based on the prediction
                        if(data == "Glaucoma"){
                            $('#description').html(`
                                <h3>Result: Glaucoma</h3>
                                <p><b>What is Glaucoma:</b> Glaucoma is a group of eye conditions that damage the optic nerve, often due to increased pressure in the eye. It is a leading cause of irreversible blindness if left untreated.</p>
                                <h4>Symptoms:</h4>
                                <ol>
                                    <li><b>Gradual Loss of Peripheral Vision:</b> Often unnoticed in the early stages, peripheral vision gradually diminishes.</li>
                                    <li><b>Tunnel Vision:</b> Advanced stages may lead to a tunnel-like narrowing of the visual field.</li>
                                    <li><b>Blurred Vision:</b> Vision becomes blurred or hazy.</li>
                                    <li><b>Halos Around Lights:</b> Halos or glare, especially around lights.</li>
                                    <li><b>Redness in the Eye:</b> In some cases, there may be redness and discomfort.</li>
                                </ol>
                                <h4>Prevention:</h4>
                                <p>While some risk factors are unavoidable, early detection and management can prevent vision loss:</p>
                                <ol>
                                    <li><b>Regular Eye Exams:</b> Comprehensive eye exams are crucial, as glaucoma can be asymptomatic in the early stages.</li>
                                    <li><b>Eye Pressure Monitoring:</b> Regular monitoring of intraocular pressure, especially for individuals at higher risk.</li>
                                    <li><b>Healthy Lifestyle:</b> A healthy lifestyle, including regular exercise, can contribute to overall eye health.</li>
                                </ol>
                                <h4>Treatment:</h4>
                                <ol>
                                    <li><b>Medication:</b> Eye drops or oral medications to reduce intraocular pressure.</li>
                                    <li><b>Laser Therapy:</b> Laser trabeculoplasty to improve fluid drainage.</li>
                                    <li><b>Surgery:</b> In advanced cases, surgical procedures may be necessary to improve fluid outflow and reduce pressure.</li>
                                </ol>
                                <p><b>Note to Users:</b> If your prediction indicates a risk of glaucoma, it is crucial to consult with an eye care professional promptly. Glaucoma is often asymptomatic in its early stages, making regular eye exams vital for early detection.</p>
                            `);
                        }
                        else if(data == "Diabetic Retinopathy"){
                            $('#description').html(`
                                <h3>Result: Diabetic Retinopathy</h3>
                                <p><b>What is Diabetic Retinopathy:</b> Diabetic retinopathy is a diabetes-related eye condition that affects the blood vessels in the retina. High levels of blood sugar can damage the tiny blood vessels, leading to vision problems and, in severe cases, blindness.</p>
                                <h4>Symptoms:</h4>
                                <ol>
                                    <li><b>Blurred Vision:</b> Vision becomes blurred, making it difficult to focus.</li>
                                    <li><b>Floaters:</b> Dark spots or "floaters" may appear in the field of vision.</li>
                                    <li><b>Impaired Color Vision:</b> Difficulty perceiving colors accurately.</li>
                                    <li><b>Dark or Empty Areas in Vision:</b> Parts of the visual field may appear dark or empty.</li>
                                    <li><b>Vision Fluctuations:</b> Vision may vary due to changes in blood sugar levels.</li>
                                </ol>
                                <h4>Prevention:</h4>
                                <p>Effective management of diabetes is key to preventing diabetic retinopathy. Additionally:</p>
                                <ol>
                                    <li><b>Regular Eye Exams:</b> Annual comprehensive eye exams can detect early signs.</li>
                                    <li><b>Blood Sugar Control:</b> Maintain stable blood sugar levels through proper diabetes management.</li>
                                    <li><b>Blood Pressure Control:</b> Manage blood pressure to reduce the risk of complications.</li>
                                    <li><b>Healthy Lifestyle:</b> Adopt a healthy lifestyle, including a balanced diet and regular exercise.</li>
                                </ol>
                                <h4>Treatment:</h4>
                                <ol>
                                    <li><b>Laser Therapy:</b> In early stages, laser treatment (photocoagulation) may be used to seal leaking blood vessels.</li>
                                    <li><b>Intraocular Injections:</b> Medications injected into the eye can slow the progression of the disease.</li>
                                    <li><b>Vitrectomy:</b> In advanced cases, vitrectomy surgery may be performed to remove blood from the vitreous gel.</li>
                                    <li><b>Anti-VEGF Injections:</b> Medications that inhibit the growth of abnormal blood vessels.</li>
                                </ol>
                                <p><b>Note to Users:</b> If your prediction indicates a risk of diabetic retinopathy, it is crucial to consult with a healthcare professional specializing in eye care for a comprehensive examination. Timely intervention and proper management can significantly impact the course of the disease.</p>
                            `);
                        }
                        else if(data == "Cataract"){
                            $('#description').html(`
                                <h3>Result: Cataract</h3>
                                <p><b>What is Cataract:</b> Cataract is a common eye condition characterized by the clouding of the eye's lens, leading to blurred vision and visual impairment. It often occurs with aging but can also result from other factors like injury, certain medications, or medical conditions.</p>
                                <h4>Symptoms:</h4>
                                <ol>
                                    <li><b>Cloudy or Blurry Vision:</b> Vision becomes hazy, making it difficult to see clearly.</li>
                                    <li><b>Sensitivity to Light:</b> Increased sensitivity to bright lights, causing discomfort.</li>
                                    <li><b>Difficulty Seeing at Night:</b> Impaired vision in low-light conditions.</li>
                                    <li><b>Changes in Color Perception:</b> Colors may appear faded or yellowed.</li>
                                    <li><b>Frequent Changes in Prescription:</b> Need for more frequent changes in eyeglass prescription.</li>
                                </ol>
                                <h4>Prevention:</h4>
                                <p>While some risk factors are unavoidable, several measures can be taken to reduce the risk of developing cataracts:</p>
                                <ol>
                                    <li><b>Regular Eye Exams:</b> Routine eye check-ups can detect early signs of cataracts.</li>
                                    <li><b>UV Protection:</b> Wearing sunglasses that block UV rays can help prevent cataracts.</li>
                                    <li><b>Healthy Diet:</b> A diet rich in antioxidants (vitamins C and E) may reduce cataract risk.</li>
                                    <li><b>Quit Smoking:</b> Smoking is linked to an increased risk of cataracts, so quitting can be beneficial.</li>
                                    <li><b>Manage Diabetes:</b> Proper management of diabetes can help prevent cataracts.</li>
                                </ol>
                                <h4>Treatment:</h4>
                                <ol>
                                    <li><b>Prescription Glasses:</b> In the early stages, vision may be improved with new glasses or contact lenses.</li>
                                    <li><b>Cataract Surgery:</b> When vision loss significantly affects daily life, cataract surgery may be recommended.
                                        <ul>
                                            <li><b>Phacoemulsification:</b> Common method using ultrasound to break up and remove the cloudy lens.</li>
                                            <li><b>Intraocular Lens (IOL):</b> An artificial lens replaces the natural lens.</li>
                                            <li><b>Laser Surgery:</b> In some cases, lasers may assist in cataract surgery.</li>
                                        </ul>
                                    </li>
                                </ol>
                                <p><b>Note to Users:</b> If you have received a prediction indicating a risk of cataracts, it is crucial to consult with an eye care professional for a comprehensive examination. Early detection and proper management can significantly improve outcomes.</p>
                            `);
                        }
                        else if(data == "Normal"){
                            $('#description').html(`
                                <h3>Result: Normal Eyesight</h3>
                                <p> Congratulations! The prediction indicates that your eyesight is currently within the normal range. This means that your eyes are functioning well, and there are no indications of common eye conditions such as cataracts, diabetic retinopathy, or glaucoma.</p>
                                <h4>What Does This Mean:</h4>
                                <p>Having normal eyesight implies that your vision is clear, and your eyes are healthy. However, it's essential to continue practicing good eye care habits, including regular eye check-ups, maintaining a healthy lifestyle, and protecting your eyes from environmental factors like excessive UV exposure.</p>
                                <h4>Recommendations:</h4>
                                <ol>
                                    <li><b>Regular Eye Exams:</b> Even with normal eyesight, routine eye check-ups are valuable for early detection of any potential issues.</li>
                                    <li><b>Eye Protection:</b> Consider using sunglasses that block UV rays when outdoors to protect your eyes.</li>
                                    <li><b>Healthy Lifestyle:</b> Maintain a healthy lifestyle, including a balanced diet and regular exercise, to support overall eye health.</li>
                                </ol>
                            `);
                        }
                        else {
                            $('#description').html(`<p>Unexpected result: ${data}</p>`);
                        }

                        console.log('Success!');
                        
                        // Reset the description when the imageUpload is clicked again
                        $('#imageUpload').on('click', function(){
                            $('#description').html(`
                                <h5>Embark on a seamless journey towards comprehensive eye health understanding!</h5>
                                <p>By effortlessly uploading an image, you empower our advanced model, which harnesses the strength of robust deep-learning techniques such as Inception V3, VGG19, and Xception V3.<br><br>This cutting-edge technology enables the accurate prediction and categorization of various eye conditions, such as <b>Cataract, Diabetic Retinopathy, and Glaucoma.</b>
                                Experience the precision of our predictive analytics as you receive tailored insights and detailed descriptions for each identified condition.<br><br>This user-friendly process is designed to not only provide you with precise predictions but also enhance your awareness of eye health. Your active involvement becomes the cornerstone of this journey, contributing to a more informed and proactive approach to caring for your eyes.</p>
                            `);
                        });
                    },
                    error: function(xhr, status, error){
                        $('.loader').hide();
                        $('#description').html(`<p>An error occurred. Please try again.</p>`);
                    }
                });
            });
        });
    </script>
</body>
</html>
